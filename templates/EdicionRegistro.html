{% extends './base.html' %} 
{% block title %} Edici√≥n Registro {% endblock %} 
{% block body %}
<div class="container mt-5">
  <form id="formularioEdicion">
    <div id="resumenDatos"></div>
    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
  </form>
</div>

<script>
  const datosDiagnostico = JSON.parse(localStorage.getItem("datosDiagnostico")) || {};
  const datosNotasSeguimiento = JSON.parse(localStorage.getItem("datosNotasSeguimiento")) || {};
  const datosEvaluacionPostura = JSON.parse(localStorage.getItem("datosEvaluacionPostura")) || {};
  const datosCabezaTorax = JSON.parse(localStorage.getItem("datosCabezaTorax")) || {};
  const datosMiembroInferiores = JSON.parse(localStorage.getItem("datosMiembroInferiores")) || {};
  const datosFicha = JSON.parse(localStorage.getItem("datosFicha")) || {};
  const datosMiembroSuperior = JSON.parse(localStorage.getItem("datosMiembroSuperior")) || {};

  const combinedData = {
    ...datosFicha,
    ...datosMiembroSuperior,
    ...datosMiembroInferiores,
    ...datosCabezaTorax,
    ...datosEvaluacionPostura,
    ...datosNotasSeguimiento,
    ...datosDiagnostico,
  };

  const resumenContainer = document.getElementById("resumenDatos");

  function mostrarDatos(datos, titulo) {
    const section = document.createElement("div");
    section.classList.add("mb-3");
    section.innerHTML = `<h4>${titulo}</h4>`;
    
    for (const key in datos) {
      if (typeof datos[key] === "boolean") {
        section.innerHTML += `
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="${key}" name="${key}" ${datos[key] ? 'checked' : ''}>
            <label class="form-check-label" for="${key}"><strong>${key}:</strong></label>
          </div>`;
      } else if (typeof datos[key] === "object" && datos[key] !== null) {
        // Para manejar objetos anidados
        section.innerHTML += `<p><strong>${key}:</strong></p>`;
        for (const subKey in datos[key]) {
          section.innerHTML += `
            <div class="mb-3" style="margin-left: 20px;">
              <label for="${key}_${subKey}" class="form-label"><strong>${subKey}:</strong></label>
              <input type="text" class="form-control" id="${key}_${subKey}" name="${key}_${subKey}" value="${datos[key][subKey]}">
            </div>`;
        }
      } else {
        // Si es un campo de texto
        section.innerHTML += `
          <div class="mb-3">
            <label for="${key}" class="form-label"><strong>${key}:</strong></label>
            <input type="text" class="form-control" id="${key}" name="${key}" value="${datos[key]}">
          </div>`;
      }
    }
    resumenContainer.appendChild(section);
  }

  // Mostrar los datos combinados
  mostrarDatos(combinedData, 'Datos del Registro');

</script>
{% endblock %}
